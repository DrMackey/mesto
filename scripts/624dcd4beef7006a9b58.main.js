(()=>{"use strict";const e=document.querySelector(".body"),t=e.querySelector(".profile__edit-button"),s=e.querySelector(".profile__add-button"),n=e.querySelector(".profile__avatar-wrapper"),i=".profile__name",o=".profile__subtitle",r=e.querySelector("#name"),a=e.querySelector("#subtitle"),l=Array.from(e.querySelectorAll(".popup__input-form")),u={};class h{constructor({name:e,link:t,likes:s,_id:n,owner:i},o,r,{openPopupListener:a,handleLikeClick:l},u){this._photoLinkCard=t,this._textCard=e,this._likes=s,this._idCard=n,this._ownerId=i._id,this._templateSelector=document.querySelector(o).content,this._handleClickImage=r,this._openPopupListener=a,this._handleLikeClick=l,this._profileId=u}_getTemplate(){return this._templateSelector.querySelector(".list__item").cloneNode(!0)}_setEventListeners(){this._element.querySelector(".list__delete-button").addEventListener("click",(()=>this._openPopupListener(this._idCard,this._element))),this._buttonLike.addEventListener("click",(()=>this._handleButtonLike())),this._image.addEventListener("click",(e=>{this._handleClickImage(e.target)}))}_handleButtonLike(){this._buttonLike.classList.toggle("list__like-button_active"),this._handleLikeClick(this._buttonLike,this._idCard)}editLikesValue(e){this._likesContainer.textContent=e.length}_checkYourLike(){this._likes.forEach((e=>{e._id===this._profileId&&this._buttonLike.classList.add("list__like-button_active")}))}_checkValueLikes(){}generateCard(){return this._element=this._getTemplate(),this._image=this._element.querySelector(".list__image"),this._likesContainer=this._element.querySelector(".list__likes"),this._buttonLike=this._element.querySelector(".list__like-button"),this._deleteButton=this._element.querySelector(".list__delete-button"),this._setEventListeners(),this._profileId===this._ownerId&&this._deleteButton.classList.add("list__delete-button_visible"),this._image.src=this._photoLinkCard,this._image.alt=this._textCard,this._checkYourLike(),this._likesContainer.textContent=this._likes.length,this._element.querySelector(".list__title").textContent=this._textCard,this._element}}class c{constructor(e,t){this._config=e,this._formElement=t,this._buttonElement=this._formElement.querySelector(this._config.submitButtonSelector),this._inputList=Array.from(this._formElement.querySelectorAll(this._config.inputSelector))}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}_enableButton(){this._buttonElement.classList.remove(this._config.inactiveButtonClass),this._buttonElement.disabled=!1}_disabledButton(){this._buttonElement.classList.add(this._config.inactiveButtonClass),this._buttonElement.disabled="disabled"}_toggleButtonState(){this._hasInvalidInput()?this._disabledButton():this._enableButton()}_showInputError(e,t){const s=this._formElement.querySelector(`.${e.id}-input-error`);e.classList.add(this._config.inputErrorClass),s.textContent=t,s.classList.add(this._config.errorClass)}_hideInputError(e){const t=this._formElement.querySelector(`.${e.id}-input-error`);e.classList.remove(this._config.inputErrorClass),t.classList.remove(this._config.errorClass),t.textContent=""}isValid(e){e.validity.valid?(this._hideInputError(e),this._toggleButtonState(this._buttonElement)):(this._showInputError(e,e.validationMessage),this._toggleButtonState(this._buttonElement))}_setEventListeners(){this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this.isValid(e)}))}))}resetValidation(){this._inputList.forEach((e=>{this._hideInputError(e)})),this._toggleButtonState()}enableValidation(){this._setEventListeners()}}class _{constructor(e){this._popupSelector=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this)}_handleEscClose(e){"Escape"===e.key&&this.close()}_handleEventClose(e){(e.target.classList.contains("popup")||e.target.classList.contains("popup__button-close"))&&this.close()}setEventListeners(){this._popupSelector.addEventListener("click",(e=>this._handleEventClose(e)))}open(){document.addEventListener("keydown",this._handleEscClose),this._popupSelector.classList.add("popup_opened")}close(){document.removeEventListener("keydown",this._handleEscClose),this._popupSelector.classList.remove("popup_opened")}}class d extends _{constructor({handleFormSubmit:e},t){super(t),this._popupElement=document.querySelector(t),this._popupButton=this._popupElement.querySelector(".popup__button"),this._handleFormSubmit=e,this._inputList=Array.from(this._popupElement.querySelectorAll(".popup__input")),this._cardId=""}_handleEventSubmit(e){e.preventDefault(),this._handleFormSubmit(this._getInputValues())}_getInputValues(){if(this._inputList.length>0){const e={};return this._inputList.forEach((t=>{e[t.name]=t.value})),e}return{cardId:this._cardId,element:this._element}}setEventListeners(){super.setEventListeners(),this._formElement=this._popupElement.querySelector(".popup__input-form"),this._formElement.addEventListener("submit",(e=>{this._handleEventSubmit(e)}))}handleStateButtonLoading(){this._popupButton.textContent="Сохранение..."}handleStateButtonDone(){this._popupButton.textContent="Сохранить"}open(e,t){super.open(),this._cardId=e,this._element=t}close(){super.close(),this._formElement.reset()}}const p={formSelector:".popup__input-form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"};let m;const L=new class{constructor({baseUrl:e,headers:t}){this._url=e,this._headers=t}getInitialCards(){return fetch(`${this._url}/cards`,{headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)))}getProfileId(){return fetch(`${this._url}/users/me`,{headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)))}getProfileData(){return fetch(`${this._url}/users/me`,{headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)))}patchUserInfo({name:e,subtitle:t}){return fetch(`${this._url}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then((e=>{if(e.ok)return e.json();Promise.reject(`Ошибка: ${e.status}`)}))}postCreateCard({name:e,link:t}){return fetch(`${this._url}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then((e=>{if(e.ok)return e.json();Promise.reject(`Ошибка: ${e.status}`)}))}deleteCard(e){return fetch(`${this._url}/cards/${e}`,{method:"DELETE",headers:this._headers}).then((e=>{if(e.ok)return e.json();Promise.reject(`Ошибка: ${e.status}`)}))}putLike(e){return fetch(`${this._url}/cards/${e}/likes`,{method:"PUT",headers:this._headers}).then((e=>{if(e.ok)return e.json();Promise.reject(`Ошибка: ${e.status}`)}))}deleteLike(e){return fetch(`${this._url}/cards/${e}/likes`,{method:"DELETE",headers:this._headers}).then((e=>{if(e.ok)return e.json();Promise.reject(`Ошибка: ${e.status}`)}))}updateAvatar(e){return fetch(`${this._url}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then((e=>{if(e.ok)return e.json();Promise.reject(`Ошибка: ${e.status}`)}))}}({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-70",headers:{authorization:"ce17d6b4-1913-45c3-a0e7-cd331bad7135","Content-Type":"application/json"}});L.getInitialCards().then((e=>{f.renderItems(e)})).catch((e=>{console.log(e)}));const E=new d({handleFormSubmit:({cardId:e,element:t})=>{L.deleteCard(e).then((()=>{t.remove(),t=null,E.close()})).catch((e=>{console.log(e),E.close()}))}},".popup_type_delete"),g=new class{constructor(e,t){this._nameElement=document.querySelector(e),this._captionElement=document.querySelector(t)}getUserInfo(){return{name:this._nameElement.textContent,caption:this._captionElement.textContent}}setUserInfo({name:e,about:t}){this._nameElement.textContent=e,this._captionElement.textContent=t}}(i,o),S=new class extends _{constructor(e){super(e),this._popupImageSrc=document.querySelector(".popup__image"),this._popupImageCaption=document.querySelector(".popup__caption"),this._popupImage=document.querySelector(e)}setEventListeners(){super.setEventListeners()}open(e){this._imageSrc=e.src,this._imageAlt=e.alt,this._popupImageSrc.src=this._imageSrc,this._popupImageSrc.alt=this._imageAlt,this._popupImageCaption.textContent=this._imageAlt,super.open()}}(".popup_type_image"),f=new class{constructor({renderer:e},t){this._renderer=e,this._cardsContainer=document.querySelector(t)}addItem(e){this._cardsContainer.prepend(e)}renderItems(e){e.forEach((e=>this._renderer(e)))}}({renderer:e=>{f.addItem(k(e))}},".list");function k(e){const t=new h(e,"#card-template",y,{openPopupListener:(e,t)=>{E.open(e,t)},handleLikeClick:(e,s)=>{e.classList.contains("list__like-button_active")?L.putLike(s).then((e=>{t.editLikesValue(e.likes)})).catch((e=>{console.log(e)})):L.deleteLike(s).then((e=>{t.editLikesValue(e.likes)})).catch((e=>{console.log(e)}))}},m);return t.generateCard()}const v=new d({handleFormSubmit:e=>{v.handleStateButtonLoading(),L.patchUserInfo(e).then((e=>{g.setUserInfo(e),v.close(),v.handleStateButtonDone()})).catch((e=>{console.log(e),v.close()}))}},".popup_type_edit"),C=new d({handleFormSubmit:e=>{C.handleStateButtonLoading(),L.updateAvatar(e.link).then((e=>{document.querySelector(".profile__avatar").src=e.avatar,C.close(),C.handleStateButtonLoading()})).catch((e=>{console.log(e),C.close()}))}},".popup_type_update-avatar"),b=new d({handleFormSubmit:e=>{b.handleStateButtonLoading(),L.postCreateCard(e).then((e=>{f.addItem(k(e)),b.close(),b.handleStateButtonLoading()})).catch((e=>{console.log(e),b.close()}))}},".popup_type_new-card");function y(e){S.open(e)}l.forEach((e=>{const t=new c(p,e);t.enableValidation(),u[e.closest(".popup").id]=t})),t.addEventListener("click",(function(){const e=g.getUserInfo();r.value=e.name,a.value=e.caption,u.popup_type_edit.resetValidation(),v.open()})),s.addEventListener("click",(function(){u["popup_type_new-card"].resetValidation(),b.open()})),n.addEventListener("click",(function(){u["popup_type_update-avatar"].resetValidation(),C.open()})),b.setEventListeners(),v.setEventListeners(),S.setEventListeners(),E.setEventListeners(),C.setEventListeners(),L.getProfileData().then((e=>{document.querySelector(".profile__avatar").src=e.avatar,document.querySelector(i).textContent=e.name,document.querySelector(o).textContent=e.about,m=e._id})).catch((e=>{console.log(e)}))})();