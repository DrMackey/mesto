(()=>{"use strict";const e=document.querySelector(".body"),t=e.querySelector(".profile__edit-button"),s=e.querySelector(".profile__add-button"),n=e.querySelector(".profile__name"),i=e.querySelector("#name"),o=e.querySelector("#subtitle"),r=Array.from(e.querySelectorAll(".popup__input-form")),l={};class a{constructor({name:e,link:t},s,n){this._photoLinkCard=t,this._textCard=e,this._templateSelector=document.querySelector(`${s}`).content,this._handleClickImage=n}_getTemplate(){return this._templateSelector.querySelector(".list__item").cloneNode(!0)}_removeCard(){this._element.remove()}_setEventListeners(){this._element.querySelector(".list__delete-button").addEventListener("click",(()=>this._removeCard())),this._buttonLike.addEventListener("click",(()=>this._handleButtonLike())),this._image.addEventListener("click",(e=>{this._handleClickImage(e.target)}))}_handleButtonLike(){this._buttonLike.classList.toggle("list__like-button_active")}generateCard(){return this._element=this._getTemplate(),this._image=this._element.querySelector(".list__image"),this._buttonLike=this._element.querySelector(".list__like-button"),this._setEventListeners(),this._image.src=this._photoLinkCard,this._image.alt=this._textCard,this._element.querySelector(".list__title").textContent=this._textCard,this._element}}class p{constructor(e,t){this._config=e,this._formElement=t,this._buttonElement=this._formElement.querySelector(this._config.submitButtonSelector),this._inputList=Array.from(this._formElement.querySelectorAll(this._config.inputSelector))}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}_enableButton(){this._buttonElement.classList.remove(this._config.inactiveButtonClass),this._buttonElement.disabled=!1}_disabledButton(){this._buttonElement.classList.add(this._config.inactiveButtonClass),this._buttonElement.disabled="disabled"}_toggleButtonState(){this._hasInvalidInput()?this._disabledButton():this._enableButton()}_showInputError(e,t){const s=this._formElement.querySelector(`.${e.id}-input-error`);e.classList.add(this._config.inputErrorClass),s.textContent=t,s.classList.add(this._config.errorClass)}_hideInputError(e){const t=this._formElement.querySelector(`.${e.id}-input-error`);e.classList.remove(this._config.inputErrorClass),t.classList.remove(this._config.errorClass),t.textContent=""}isValid(e){e.validity.valid?(this._hideInputError(e),this._toggleButtonState(this._buttonElement)):(this._showInputError(e,e.validationMessage),this._toggleButtonState(this._buttonElement))}_setEventListeners(){this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this.isValid(e)}))}))}resetValidation(){this._inputList.forEach((e=>{this._hideInputError(e)})),this._toggleButtonState()}enableValidation(){this._setEventListeners()}}class u{constructor(e){this._popupSelector=document.querySelector(e)}_handleEscClose(e){"Escape"===e.key&&this.close()}_handleEventClose(e){(e.target.classList.contains("popup")||e.target.classList.contains("popup__button-close"))&&this.close()}setEventListeners(){this._popupSelector.addEventListener("click",(e=>this._handleEventClose(e)))}open(){document.addEventListener("keydown",(e=>this._handleEscClose(e))),this._popupSelector.classList.add("popup_opened")}close(){document.removeEventListener("keydown",(e=>this._handleEscClose(e))),this._popupSelector.classList.remove("popup_opened")}}class c extends u{constructor({handleFormSubmit:e},t){super(t),this._popupElement=document.querySelector(t),this._handleFormSubmit=e,this._inputList=Array.from(this._popupElement.querySelectorAll(".popup__input"))}_lisenerHandleEventSubmit(e){e.preventDefault(),this._handleFormSubmit(this._getInputValues())}_getInputValues(){const e={};return this._inputList.forEach((t=>{e[t.name]=t.value})),e}setEventListeners(){super.setEventListeners(),this.test=e=>this._lisenerHandleEventSubmit(e),this._formElement=this._popupElement.querySelector(".popup__input-form"),this._formElement.addEventListener("submit",this.test)}close(){super.close(),this._formElement.reset(),this._formElement.removeEventListener("submit",this.test)}}const _={formSelector:".popup__input-form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},d=new class{constructor(e,t){this._nameElement=e,this._captionElement=document.querySelector(t)}getUserInfo(){return{name:this._nameElement.textContent,caption:this._captionElement.textContent}}setUserInfo({name:e,subtitle:t}){this._nameElement.textContent=e,this._captionElement.textContent=t}}(n,".profile__subtitle"),h=new class extends u{constructor(e){super(e),this._popupImageSrc=document.querySelector(".popup__image"),this._popupImageCaption=document.querySelector(".popup__caption"),this._popupImage=document.querySelector(e)}open(e){this._imageSrc=e.src,this._imageAlt=e.alt,this._popupImageSrc.src=this._imageSrc,this._popupImageSrc.alt=this._imageAlt,this._popupImageCaption.textContent=this._imageAlt,super.setEventListeners(),super.open()}}(".popup_type_image"),m=new class{constructor({renderer:e},t){this._renderer=e,this._cardsContainer=document.querySelector(t)}addItem(e){this._cardsContainer.prepend(e)}renderItems(e){e.forEach((e=>this._renderer(e)))}}({renderer:e=>{m.addItem(E(e))}},".list");function E(e){return new a(e,"#card-template",S).generateCard()}const g=new c({handleFormSubmit:e=>{d.setUserInfo(e),g.close()}},".popup_type_edit"),v=new c({handleFormSubmit:e=>{m.addItem(E(e)),v.close()}},".popup_type_new-card");function S(e){h.open(e)}r.forEach((e=>{const t=new p(_,e);t.enableValidation(),l[e.closest(".popup").id]=t})),t.addEventListener("click",(function(){const e=d.getUserInfo();g.setEventListeners(),i.value=e.name,o.value=e.caption,l.popup_type_edit.resetValidation(),g.open()})),s.addEventListener("click",(function(){v.setEventListeners(),l["popup_type_new-card"].resetValidation(),v.open()})),m.renderItems([{name:"Архыз",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/arkhyz.jpg"},{name:"Челябинская область",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/chelyabinsk-oblast.jpg"},{name:"Иваново",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/ivanovo.jpg"},{name:"Камчатка",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kamchatka.jpg"},{name:"Холмогорский район",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kholmogorsky-rayon.jpg"},{name:"Байкал",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/baikal.jpg"}])})();